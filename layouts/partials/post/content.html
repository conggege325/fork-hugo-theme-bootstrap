{{- $isPrivate := .Params.isPrivate -}}
{{- if ne $isPrivate true -}}
    {{- $isPrivate = false -}}
{{- end -}}

<div class="post-content mb-3" data-bs-spy="scroll" data-bs-target="#TableOfContents" tabindex="0">
    {{- if and .Summary (default false $.Site.Params.post.readMoreFromContent) (hasPrefix .Content .Summary) }}
        <div id="post-summary">{{ .Summary }}</div>
        <div id="post-content-body">
            {{- if $isPrivate -}}
                <script>
                    {{- $safeContent := strings.TrimPrefix .Summary .Content | safeHTML | string -}}
                    const ciphertext = '{{- aes_enc $safeContent $.Site.Params.secretKey $.Site.Params.secretIv -}}'
                    document.addEventListener('show_content', function(e) {
                        const originalText = decrypt(ciphertext, e.detail)
                        $('#post-content-body').append(originalText)
                    });
                </script>
            {{- else -}}
                {{- strings.TrimPrefix .Summary .Content | safeHTML -}}
            {{- end -}}
        </div>
    {{- else }}
        <div id="post-content-body">
            {{- if $isPrivate -}}
                <script>
                    {{- $unsafeContent := .Content | string -}}
                    const ciphertext = '{{- aes_enc $unsafeContent $.Site.Params.secretKey $.Site.Params.secretIv -}}'
                    document.addEventListener('show_content', function(e) {
                        const originalText = decrypt(ciphertext, e.detail)
                        $('#post-content-body').append(originalText)
                    });
                </script>
            {{- else -}}
                {{ .Content }}
            {{- end -}}
        </div>
    {{- end }}
</div>
